<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Marriott Hotel admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app">
    <header class="header">
        <div class="search-container">
            <form class="d-flex">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
        </div>
    </header>
    <div class="d-flex justify-content-between">
        <nav>
            <div class="sidebar-top">

                <a href="#" class="logo__wrapper">
                    <img src="/templates/sidebar-03/assets/img.png" alt="Logo" class="logo">
                </a>
            </div>
            <div class="sidebar-links">
                <ul>
                    <li>
                        <a href="#home" title="Home" class="tooltip">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                 stroke-width="2"
                                 stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M5 12l-2 0l9 -9l9 9l-2 0"></path>
                                <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"></path>
                                <path d="M10 12h4v4h-4z"></path>
                            </svg>
                            <span class="link hide">Home</span>
                            <span class="tooltip__content">Home</span>
                        </a>
                    </li>
                    <li>
                        <a href="#portfolio" title="Portfolio" class="tooltip" data-toggle="modal"
                           data-target="#exampleModal" onclick="handleClickAddForm()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                 class="bi bi-hospital" viewBox="0 0 16 16">
                                <path d="M8.5 5.034v1.1l.953-.55.5.867L9 7l.953.55-.5.866-.953-.55v1.1h-1v-1.1l-.953.55-.5-.866L7 7l-.953-.55.5-.866.953.55v-1.1zM13.25 9a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25zM13 11.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25zm.25 1.75a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25zm-11-4a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 3 9.75v-.5A.25.25 0 0 0 2.75 9zm0 2a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25zM2 13.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25z"/>
                                <path d="M5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1a1 1 0 0 1 1 1v4h3a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h3V3a1 1 0 0 1 1-1zm2 14h2v-3H7zm3 0h1V3H5v12h1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1zm0-14H6v1h4zm2 7v7h3V8zm-8 7V8H1v7z"/>
                            </svg>

                            <span class="link hide">Add Room</span>
                            <span class="tooltip__content">Add Room</span>
                        </a>
                    </li>

                    <li>
                        <a href="#explore" title="Explore" class="tooltip" data-toggle="modal" data-target="#Modal">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-add" viewBox="0 0 16 16">
                                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h4a.5.5 0 1 0 0-1h-4a.5.5 0 0 1-.5-.5V7.207l5-5 6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z"/>
                                <path d="M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-3.5-2a.5.5 0 0 0-.5.5v1h-1a.5.5 0 0 0 0 1h1v1a.5.5 0 1 0 1 0v-1h1a.5.5 0 1 0 0-1h-1v-1a.5.5 0 0 0-.5-.5"/>
                            </svg>
                            <span class="link hide">Type room</span>
                            <span class="tooltip__content">Type room</span>
                        </a>
                    </li>
                </ul>
            </div>


            <div class="sidebar-links">
                <ul>
                    <li id="login-link">
                        <a href="../login.html" title="login" class="tooltip">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                 class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                      d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0z"/>
                                <path fill-rule="evenodd"
                                      d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708z"/>
                            </svg>
                        </a>
                    </li>

                    <li id="logout-link" style="display:none;">
                        <a href="#" title="logout" class="tooltip" onclick="logout()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                 class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                      d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/>
                                <path fill-rule="evenodd"
                                      d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                            </svg>
                            <span class="link hide" id="user-info"></span>
                        </a>
                    </li>
                </ul>
            </div>


            <div class="sidebar-bottom hide">
                <img src="/templates/sidebar-03/assets/img.png" alt="Diamond">
                <p id="hello-user">
                    Welcome to the hotel +
                </p>
            </div>
            <div class="expand-btn">
                <img
                        src="assets/right-collapse.svg"
                        alt="Left Collapse"
                >
                <span class="hide">
                  log out
                </span>
            </div>
        </nav>
        <div class="content">
            <div id="roomList">
                <table class="table">
                    <tr>
                        <th>code</th>
                        <th>description</th>
                        <th>image</th>
                        <th>price</th>
                        <th>status</th>
                        <th>type</th>
                        <th>delete</th>
                        <th data-toggle="modal" data-target="#exampleModalCenter" onclick="handleClickUpdateForm()">
                            update
                        </th>
                    </tr>
                </table>
            </div>
            <div class="mb-3 mt-5 d-flex justify-content-center" id="paging">
                <ul class="pagination ">
                    <li class="page-item disabled">
                        <a class="page-link" onclick="pageRenderPitch()" tabindex="-1"
                           aria-disabled="true">Previous</a>
                    </li>
                    <li class="page-item active" aria-current="page">
                        <a class="page-link" onclick="pageRenderPitch()">1 </a>
                    </li>
                    <!--            <li class="page-item"><a class="page-link" onclick="pageRenderPitch()">2</a></li>-->
                    <!--            <li class="page-item"><a class="page-link" href="#">3</a></li>-->
                    <li class="page-item">
                        <a class="page-link" onclick="pageRenderPitch()">Next</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">UPDATE</h5>

            </div>
            <div class="modal-body">

                <div class="modal-body">
                    <div class="row">

                        <input type="number" id="room-id" hidden>


                        <div class="col-xl-12">
                            <input type="text" id="update-code" placeholder="code">
                        </div>

                        <div class="col-xl-12">
                            <input type="text" id="update-description" placeholder="description">
                        </div>

                        <div class="col-xl-12">
                            <input type="file" id="update-image" placeholder="image">
                        </div>

                        <div class="col-xl-12">
                            <input type="text" id="update-price" placeholder="price"/>
                        </div>

                        <div class="col-xl-12 ">
                            <select id="update-status" name="status" required>
                                <option value="true">Active</option>
                                <option value="false">Inactive</option>
                            </select>
                        </div>

                        <div class="col-xl-12">
                            <select id="update-types" name="status" required>
                                <option value="true">Active</option>
                                <option value="false">Inactive</option>
                            </select>
                        </div>

                    </div>
                </div>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="updateRoom()">UPDATE ROOM</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">CREATE</h5>

            </div>
            <div class="modal-body">
                <div class="row">

                    <div class="col-xl-12">
                        <input type="text" id="create-code" placeholder="code">
                    </div>

                    <div class="col-xl-12">
                        <input type="text" id="create-description" placeholder="description">
                    </div>

                    <div class="col-xl-12">
                        <input type="file" id="create-image" placeholder="image">
                    </div>

                    <div class="col-xl-12">
                        <input type="text" id="create-price" placeholder="price" />
                    </div>

                    <div class="col-xl-12 ">
                        <select id="create-status" name="status"  required>
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>

                    <div class="col-xl-12">
                        <select id="create-types" name="status"  required>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="addNewRoom()">ADD ROOM</button>
            </div>
        </div>
    </div>
</div>




<!-- Modal -->
<div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ModalLabel">TYPE ROOM</h5>

            </div>
            <div class="modal-body">
                <input type="number" id="type-id" hidden>


                <div class="col-xl-12">
                    <input type="text" id="type-name" placeholder="code">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save type</button>
            </div>
        </div>
    </div>
</div>
<script type="module">
    import {storage} from './fireBaseConfig.js';
    import {
        ref,
        uploadBytesResumable,
        getDownloadURL
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    $(document).ready(function () {
        $("#create-image").on("change", (e) => {
            const file = e.target.files[0];
            if (file) {
                const storageRef = ref(storage, 'images/' + file.name);
                const uploadTask = uploadBytesResumable(storageRef, file);

                uploadTask.on('state_changed',
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    },
                    (error) => {
                        console.error('Upload failed:', error);
                    },
                    async () => {
                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                        localStorage.setItem("tempImage", JSON.stringify(downloadURL));
                    }
                );
            }
        })
    })

    $(document).ready(function () {
        $("#update-image").on("change", (e) => {
            const file = e.target.files[0];
            if (file) {
                const storageRef = ref(storage, 'images/' + file.name);
                const uploadTask = uploadBytesResumable(storageRef, file);

                uploadTask.on('state_changed',
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    },
                    (error) => {
                        console.error('Upload failed:', error);
                    },
                    async () => {
                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                        localStorage.setItem("tempImage", JSON.stringify(downloadURL));
                    }
                );
            }
        })
    })
</script>


<script src="script.js"></script>
<script src="room.js"></script>


<script>
    function pageRenderPitch(pageIndex) {
        $.ajax({
            url: `http://localhost:8080/api/rooms?&page=${pageIndex}`,
            type: "GET",
            crossDomain: true,
            contentType: 'application/json',
            dataType: "json",
            success: (response) => {
                renderBuisiness(response.content, "#roomList");
                renderPaging(response.totalPages, response.pageable.pageNumber);
            },
            error: (e) => {
                console.log(e);
            }
        })
    }


    function renderBuisiness(response, idRender) {
        let content = '<table id="display-list" border="1"><tr>' +
            '<th>code</th>' +
            '<th>description</th>' +
            '<th>image</th>' +
            '<th>price</th>' +
            '<th>status</th>' +
            '<th>type</th>' +
            '</tr>';
        if (response.length == null || response.length == "") {
            content = `<div class="text-center"> No List</div>`;
        } else {
            for (let i = 0; i < response.length; i++) {
                content += getRoom(response[i]);
            }
        }
        content += "</table>";
        $(idRender).html(content);

    }


    function renderPaging(totalPages, pageNumber) {
        let temp = "<ul class='pagination'>";
        if (pageNumber == 0) {
            temp += `<li class='page-item disabled'><a class="page-link" tabindex="-1" aria-disabled="true">Previous</a></li>`;
        } else {
            temp += `<li class='page-item'><a class="page-link" onclick="pageRenderPitch(${pageNumber - 1})">Previous</a></li>`;
        }

        for (let i = 0; i < totalPages; i++) {
            if (i == pageNumber) {
                temp += `<li class="page-item active" aria-current="page">
                        <a class="page-link" onclick="pageRenderPitch(${i})">${i + 1} </a>
                    </li>`;
            } else {
                temp += `<li class="page-item"><a class="page-link" onclick="pageRenderPitch(${i})">${i + 1}</a></li>`;
            }
        }

        if (pageNumber == totalPages - 1) {
            temp += `<li class="page-item disabled"><a class="page-link" aria-disabled="true">Next</a></li></ul>`;
        } else {
            temp += `<li class="page-item"><a class="page-link" onclick="pageRenderPitch(${pageNumber + 1})">Next</a></li></ul>`;
        }

        $("#paging").html(temp);
    }
</script>

<script>
    function handleClickAddForm() {
        $.ajax({
            url: `http://localhost:8080/api/types`,
            type: "GET",
            crossDomain: true,
            contentType: 'application/json',
            dataType: "json",
            success: (response) => {
                console.log("response", response)
                let select = $("#create-types");
                select.empty();
                response.forEach(type => {
                    select.append(new Option(type.name, type.id));
                });
            },
            error: (e) => {
                console.log(e);
            }
        })
    }

    function handleClickAddFormType() {
        $.ajax({
            url: `http://localhost:8080/api/types`,
            type: "GET",
            crossDomain: true,
            contentType: 'application/json',
            dataType: "json",
            success: (response) => {
                console.log("response", response)
                let select = $("#create-types");
                select.empty();
                response.forEach(type => {
                    select.append(new Option(type.name, type.id));
                });
            },
            error: (e) => {
                console.log(e);
            }
        })
    }

    $(document).ready(function () {
        updateNavLinks();
    });

    function logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('username');
        updateNavLinks();
        window.location.href = "../templates/login.html";
    }


    function updateNavLinks() {
        const username = localStorage.getItem("username");

        if (username) {
            $('#login-link').hide();
            $('#logout-link').show();
            $('#user-info').html(`<span>${username}</span> <button class="user-info" onclick="logout()">Logout</button>`);
            $('#hello-user').text(`Welcome to the hotel  ${username}`);
        } else {
            $('#login-link').show();
            $('#logout-link').hide();
            $('#user-info').html('<a href="../login.html">Login</a>');
        }
    }



</script>


</body>
</html>
